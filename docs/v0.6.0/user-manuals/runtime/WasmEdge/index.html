<!doctype html>
<html class="docs-version-v0.6.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenYurt Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/opensearch.xml">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" color="#ffffff" href="/favicons/safari-pinned-tab.svg">
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-config" content="/favicons/browserconfig.xml"><title data-react-helmet="true">Running WasmEdge runtime on the Edge Node | OpenYurt</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openyurt.io/docs/v0.6.0/user-manuals/runtime/WasmEdge"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v0.6.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v0.6.0"><meta data-react-helmet="true" property="og:title" content="Running WasmEdge runtime on the Edge Node | OpenYurt"><meta data-react-helmet="true" name="description" content="In this article, we will cover the steps to install and set up the entire toolchain for running a WasmEdge application in OpenYurt Cluster."><meta data-react-helmet="true" property="og:description" content="In this article, we will cover the steps to install and set up the entire toolchain for running a WasmEdge application in OpenYurt Cluster."><link data-react-helmet="true" rel="shortcut icon" href="/img/openyurt.ico"><link data-react-helmet="true" rel="canonical" href="https://openyurt.io/docs/v0.6.0/user-manuals/runtime/WasmEdge"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/docs/v0.6.0/user-manuals/runtime/WasmEdge" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/zh/docs/v0.6.0/user-manuals/runtime/WasmEdge" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/docs/v0.6.0/user-manuals/runtime/WasmEdge" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.8a5667f5.css">
<link rel="preload" href="/assets/js/runtime~main.53e3239d.js" as="script">
<link rel="preload" href="/assets/js/main.2afb094d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">⭐️ If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! ⭐️</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">OpenYurt</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="http://47.243.253.79/login" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Experience-Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs/v0.6.0/">v0.6.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next</a></li><li><a class="dropdown__link" href="/docs/">v0.7.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v0.6.0/user-manuals/runtime/WasmEdge">v0.6.0</a></li><li><a class="dropdown__link" href="/docs/v0.5.0/">v0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/v0.6.0/user-manuals/runtime/WasmEdge" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/v0.6.0/user-manuals/runtime/WasmEdge" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">简体中文</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.6.0/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Installation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Core Concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.6.0/core-concepts/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Components</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">User Manuals</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Autonomy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Network</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Storage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Workload</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Monitoring</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">IOT</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Edge Runtime</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.6.0/user-manuals/runtime/docker">docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.6.0/user-manuals/runtime/containerd">containerd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v0.6.0/user-manuals/runtime/WasmEdge">Running WasmEdge runtime on the Edge Node</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Best Practices</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.6.0/best-practices/practices-1">Cloud-Edge-Device DevOps Collaboration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Manuals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v0.6.0/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->OpenYurt<!-- --> <b>v0.6.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/">latest version</a></b> (<!-- -->v0.7.0<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->v0.6.0</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Running WasmEdge runtime on the Edge Node</h1></header><p>In this article, we will cover the steps to install and set up the entire toolchain for running a WasmEdge application in OpenYurt Cluster.</p><p><a href="https://wasmedge.org/" target="_blank" rel="noopener noreferrer">WasmEdge</a>(Project under CNCF) is a <a href="https://wasmedge.org/book/en/kubernetes.html" target="_blank" rel="noopener noreferrer">OCI-compliant and k8s compatible</a> lightweight WebAssembly runtime. It provides an alternative to <a href="https://wasmedge.org/wasm_linux_container/" target="_blank" rel="noopener noreferrer">Linux containers</a> for containerized apps on edge. WasmEdge provides capability-based secure sandboxes, makes a very little assumption about the underlying OS services, and at the same time, supports <a href="https://wasmedge.org/book/en/dev.html" target="_blank" rel="noopener noreferrer">multiple programming languages</a> on the front end. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="before-we-start">Before we start<a aria-hidden="true" class="hash-link" href="#before-we-start" title="Direct link to heading">​</a></h3><p>Close the swap space of the master and node firstly.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo swapoff -a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//verify    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">free -m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, let’s configure the file <code>/etc/hosts</code> of two nodes.</p><p>Then, load the <code>br_netfilter</code> Kernel module and modify the Kernel parameter.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">//load the module</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo modprobe br_netfilter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//verify   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lsmod | grep br_netfilter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// create k8s.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">net.bridge.bridge-nf-call-ip6tables = 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">net.bridge.bridge-nf-call-iptables = 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo sysctl --system </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Last, setup the value of  <code>rp-filter</code> - adjusting the value of two parameters in <code>/etc/sysctl.d/10-network-security.conf</code> from 2 to 1 and setting up the value of <code>/proc/sys/net/ipv4/ip_forward</code> to 1.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo vi /etc/sysctl.d/10-network-security.conf </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo sysctl --system</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="install-openyurt">Install OpenYurt<a aria-hidden="true" class="hash-link" href="#install-openyurt" title="Direct link to heading">​</a></h4><p>An easier way to set up an OpenYurt Cluster is to go to the OpenYurt Experience Center. All you need to do is to sign up for an account for testing, and then you will get an OpenYurt cluster. Next, you could just use <code>yurtctl join</code> command line to join an edge node. <a href="https://openyurt.io/docs/installation/openyurt-experience-center/overview/" target="_blank" rel="noopener noreferrer">See more details here</a>.</p><p>Alternatively, you can convert a K8s  cluster to an OpenYurt cluster using <code>yurtctl convert</code> from scratch according to <a href="https://openyurt.io/docs/next/installation/yurtctl-convert-revert" target="_blank" rel="noopener noreferrer">the guide</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="install-containerd">Install containerd<a aria-hidden="true" class="hash-link" href="#install-containerd" title="Direct link to heading">​</a></h3><p>Use the following commands to install containerd on your edge node.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">export VERSION=&quot;1.5.7&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo -e &quot;Version: $VERSION&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo -e &quot;Installing libseccomp2 ...&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install -y libseccomp2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo -e &quot;Installing wget&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install -y wget</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget https://github.com/containerd/containerd/releases/download/v${VERSION}/cri-containerd-cni-${VERSION}-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget https://github.com/containerd/containerd/releases/download/v${VERSION}/cri-containerd-cni-${VERSION}-linux-amd64.tar.gz.sha256sum </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sha256sum --check cri-containerd-cni-${VERSION}-linux-amd64.tar.gz.sha256sum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo tar --no-overwrite-dir -C / -xzf cri-containerd-cni-${VERSION}-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl daemon-reload</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As the crun project support WasmEdge as default, we just need to configure the containerd configuration for runc. So we need to modify the runc parameters in <code>/etc/containerd/config.toml</code> to curn and add <code>pod_annotation</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo mkdir -p /etc/containerd/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo bash -c &quot;containerd config default &gt; /etc/containerd/config.toml&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget https://raw.githubusercontent.com/second-state/wasmedge-containers-examples/main/containerd/containerd_config.diff</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo patch -d/ -p0 &lt; containerd_config.diff</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After that, restart containerd to make the configuration take effect.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start containerd</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="install-wasmedge">Install WasmEdge<a aria-hidden="true" class="hash-link" href="#install-wasmedge" title="Direct link to heading">​</a></h3><p>Use the <a href="https://wasmedge.org/book/en/start/install.html" target="_blank" rel="noopener noreferrer">simple install script</a> to install WasmEdge on your edge node. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -sSf https://raw.githubusercontent.com/WasmEdge/WasmEdge/master/utils/install.sh | bash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="build-and-install-crun">Build and install crun<a aria-hidden="true" class="hash-link" href="#build-and-install-crun" title="Direct link to heading">​</a></h3><p>We need a crun binary that supports WasmEdge on the edge node. For now, the most straightforward approach is to build it yourself from the source. First, let&#x27;s ensure that crun dependencies are installed on your Ubuntu 20.04. For other Linux distributions, please <a href="https://github.com/containers/crun#readme" target="_blank" rel="noopener noreferrer">see here</a>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install -y make git gcc build-essential pkgconf libtool \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    libsystemd-dev libprotobuf-c-dev libcap-dev libseccomp-dev libyajl-dev \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    go-md2man libtool autoconf python3 automake</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, configure, build, and install a crun binary with WasmEdge support.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/containers/crun</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd crun</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./autogen.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./configure --with-wasmedge</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo make install</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="run-a-simple-webassembly-app">Run a simple WebAssembly app<a aria-hidden="true" class="hash-link" href="#run-a-simple-webassembly-app" title="Direct link to heading">​</a></h3><p>Next, let&#x27;s run a WebAssembly program through the Kubernetes cluster as a container in the pod. This section will start off pulling this WebAssembly-based container image from Docker hub. If you want to learn how to compile, package, and publish the WebAssembly program as a container image to Docker hub, please refer to <a href="https://wasmedge.org/book/en/kubernetes/demo/wasi.html" target="_blank" rel="noopener noreferrer">WasmEdge Book</a>.</p><p>Enter the following commands from another terminal window in the master node, and start using the cluster.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master:~# kubectl cluster-info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Kubernetes master is running at https://192.168.3.167:6443</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">KubeDNS is running at https://192.168.3.167:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Because the kubectl 1.18.9 missed annotations parameters, we need to adjust the command line here. If you are using OpenYurt Experience Center with OpenYurt 0.6.0 and Kubernetes 1.20.11 by default, please refer to the <a href="https://wasmedge.org/book/en/kubernetes/kubernetes.html" target="_blank" rel="noopener noreferrer">Kubernetes sections</a> in the WasmEdge book to run the wasm app.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// kubectl 1.18.9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo kubectl run -it --rm --restart=Never wasi-demo --image=hydai/wasm-wasi-example:with-wasm-annotation  --overrides=&#x27;{&quot;kind&quot;:&quot;Pod&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;module.wasm.image/variant&quot;:&quot;compat&quot;}} , &quot;apiVersion&quot;:&quot;v1&quot;, &quot;spec&quot;: {&quot;hostNetwork&quot;: true}}&#x27; /wasi_example_main.wasm 50000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// kubectl 1.20.11</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ​​sudo kubectl run -it --rm --restart=Never wasi-demo --image=hydai/wasm-wasi-example:with-wasm-annotation --annotations=&quot;module.wasm.image/variant=compat&quot; --overrides=&#x27;{&quot;kind&quot;:&quot;Pod&quot;, &quot;apiVersion&quot;:&quot;v1&quot;, &quot;spec&quot;: {&quot;hostNetwork&quot;: true}}&#x27; /wasi_example_main.wasm 50000000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The output from the containerized application is printed into the console. It is the same for all Kubernetes versions.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Random number: 1123434661</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Random bytes: [25, 169, 202, 211, 22, 29, 128, 133, 168, 185, 114, 161, 48, 154, 56, 54, 99, 5, 229, 161, 225, 47, 85, 133, 90, 61, 156, 86, 3, 14, 10, 69, 185, 225, 226, 181, 141, 67, 44, 121, 157, 98, 247, 148, 201, 248, 236, 190, 217, 245, 131, 68, 124, 28, 193, 143, 215, 32, 184, 50, 71, 92, 148, 35, 180, 112, 125, 12, 152, 111, 32, 30, 86, 15, 107, 225, 39, 30, 178, 215, 182, 113, 216, 137, 98, 189, 72, 68, 107, 246, 108, 210, 148, 191, 28, 40, 233, 200, 222, 132, 247, 207, 239, 32, 79, 238, 18, 62, 67, 114, 186, 6, 212, 215, 31, 13, 53, 138, 97, 169, 28, 183, 235, 221, 218, 81, 84, 235]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Printed from wasi: This is from a main function</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This is from a main function</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The env vars are as follows.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The args are as follows.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/wasi_example_main.wasm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">50000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">File content is This is in a file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod &quot;wasi-demo&quot; deleted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can now check out the pod status through the Kubernetes command line.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">crictl ps -a</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can see the events from scheduling to running the WebAssembly workload in the log. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER           IMAGE               CREATED             STATE               </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                 ATTEMPT             POD ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0c176ed65599a       0423b8eb71e31       8 seconds ago       Exited              wasi-demo    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>That&#x27;s it!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openyurtio/openyurt.io/edit/master/docs/user-manuals/runtime/WasmEdge.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-02-15T10:48:44.000Z">2/15/2022</time></b> by <b>alabulei1</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/v0.6.0/user-manuals/runtime/containerd"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->containerd</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/v0.6.0/best-practices/practices-1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cloud-Edge-Device DevOps Collaboration<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#before-we-start" class="table-of-contents__link toc-highlight">Before we start</a></li><li><a href="#install-containerd" class="table-of-contents__link toc-highlight">Install containerd</a></li><li><a href="#install-wasmedge" class="table-of-contents__link toc-highlight">Install WasmEdge</a></li><li><a href="#build-and-install-crun" class="table-of-contents__link toc-highlight">Build and install crun</a></li><li><a href="#run-a-simple-webassembly-app" class="table-of-contents__link toc-highlight">Run a simple WebAssembly app</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation/summary">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/v0.6.0/user-manuals/runtime/">DingTalk (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="http://47.243.253.79/login" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>OpenYurt Experience Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright © 2022 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/assets/js/runtime~main.53e3239d.js"></script>
<script src="/assets/js/main.2afb094d.js"></script>
</body>
</html>